<html>
   <head>
      <script src="http://cdnjs.cloudflare.com/ajax/libs/p5.js/0.4.12/p5.js"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/0.4.12/addons/p5.dom.min.js"></script>
      <script src="./button.js"></script>
      <style>
         body {
            background-color: #f0f0f0;
         }
         canvas {
             position: absolute;
             top:0;
             bottom: 0;
             left: 0;
             right: 0;
             margin: auto;
         }
      </style>
      <script>
            window.onload = function(){
               // console.log("window is loaded");
            }

            //get button obj
            var mBtns = [];
            var wCount = 22;
            var hCount = 31;
            var indices = wCount * hCount;

            function setup(){
               createCanvas(600, 600);
               smooth();

               capture = createCapture(VIDEO);
               capture.size(600, 600);
               capture.hide();

               for (var y = 0; y < hCount; y++) {
                   for (var x = 0; x < wCount; x++) {
                     var index = y * wCount + x;
                     mBtns[index] = new btn(x, y);
                  }
               }
            }

            function draw(){
              background(240);

               capture.loadPixels();

               for(var y = 0; y < hCount; y++){ 
                  for(var x = 0; x < wCount; x++){

                     var i = y*15 * 640 + x*29; // 640 * 480 
                     var darkness = (255 - capture.pixels[i*4]) / 255;

                     var mBtnIndex = y * wCount + (wCount - 1 - x);

                     if(darkness < 0.3){
                        mBtns[mBtnIndex].isHit = true;
                     } else {
                        mBtns[mBtnIndex].isHit = false;
                     }
                  }
               }
                // image(capture, 0, 0, 600, 600);
              
              for (var i = 0; i < indices; i++) {
                     mBtns[i].update();
                     mBtns[i].draw();
               }
            }

      </script>
   </head>
   <body>
   </body>
</html>
